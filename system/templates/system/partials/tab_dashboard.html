{% verbatim %}
<div v-if="tab==='dashboard'" class="grid-2">
    <div class="card">
        <div class="card-title">2025 Consumption Structure</div>
        <div class="donut-wrap">
            <div class="donut" :style="{ background: donutStyle }"></div>
            <ul class="legend">
                <li v-for="(row, i) in distribution" :key="row.type">
                    <span class="swatch" :style="{ background: palette[i % palette.length] }"></span>
                    <span class="name">{{ row.type }}</span>
                    <span class="val">{{ (row.ratio*100).toFixed(1) }}%</span>
                </li>
            </ul>
        </div>
        <div class="summary">
            <div v-for="row in distribution" :key="row.type" class="summary-row">
                <div class="summary-name">{{ row.type }}</div>
                <div class="summary-bar">
                    <div class="summary-fill" :style="{ width: (row.ratio*100).toFixed(1) + '%'}"></div>
                </div>
                <div class="summary-val">{{ (row.ratio*100).toFixed(1) }}%</div>
            </div>
        </div>
    </div>
    <div class="card">
        <div class="card-title">Financial Health Score</div>
        <div class="score-badge">Score: {{ health.score }}</div>
        <div class="score-list">
            <div class="score-item">
                <div class="score-name">Spend Control (30%)</div>
                <div class="score-val">{{ Math.round(health.spendControl) }} / 100</div>
            </div>
            <div class="score-item">
                <div class="score-name">Savings Rate (20%)</div>
                <div class="score-val">{{ Math.round(health.savingsRate) }} / 100</div>
            </div>
        </div>
    </div>
    <div class="card" style="grid-column: 1 / -1;">
        <div class="card-title">模型表现 / Model Performance</div>
        <div v-if="modelMetricsLoading" style="padding: 12px;">Loading model metrics...</div>
        <div v-else-if="!modelMetrics" style="padding: 12px;">
            <button class="primary" @click="fetchModelMetrics">Load Model Metrics</button>
        </div>
        <div v-else class="model-metrics-grid">
            <div class="metric-item">
                <div class="metric-label">规则覆盖率</div>
                <div class="metric-value">
                    {{ (modelMetrics.coverageRate || 0).toFixed(1) }}%
                </div>
                <div class="metric-sub">
                    覆盖 {{ modelMetrics.coveredTxns || 0 }} / {{ modelMetrics.totalTxns || 0 }} 笔交易
                </div>
            </div>
            <div class="metric-item">
                <div class="metric-label">未匹配占比</div>
                <div class="metric-value">
                    {{ (modelMetrics.unmatchedRate || 0).toFixed(1) }}%
                </div>
                <div class="metric-sub">
                    未匹配 {{ modelMetrics.unmatchedTxns || 0 }} 笔
                </div>
            </div>
            <div class="metric-item">
                <div class="metric-label">模型 Top-1 准确率</div>
                <div class="metric-value">
                    <span v-if="modelMetrics.modelTopK && modelMetrics.modelTopK.top1 != null">
                        {{ (modelMetrics.modelTopK.top1 * 100).toFixed(1) }}%
                    </span>
                    <span v-else>未配置</span>
                </div>
                <div class="metric-sub">
                    可在接入训练模型后填充
                </div>
            </div>
            <div class="metric-item">
                <div class="metric-label">模型 Top-3 准确率</div>
                <div class="metric-value">
                    <span v-if="modelMetrics.modelTopK && modelMetrics.modelTopK.top3 != null">
                        {{ (modelMetrics.modelTopK.top3 * 100).toFixed(1) }}%
                    </span>
                    <span v-else>未配置</span>
                </div>
                <div class="metric-sub">
                    预留指标，后续可从离线评估导入
                </div>
            </div>
        </div>
    </div>
</div>
{% endverbatim %}
