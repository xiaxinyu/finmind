{% verbatim %}
<div class="toast-container">
    <transition name="toast">
        <div v-if="toastMessage" class="toast" :class="toastKind">
            <div class="toast-icon">
                <span v-if="toastKind==='success'">✓</span>
                <span v-else-if="toastKind==='error'">✕</span>
                <span v-else>ℹ</span>
            </div>
            <div class="toast-content">{{ toastMessage }}</div>
            <div class="toast-close" @click="toastMessage=''">×</div>
        </div>
    </transition>
</div>

<transition name="modal">
    <div v-if="confirmVisible" class="modal-overlay" @keydown="onModalKeydown" tabindex="0">
        <div class="modal-box">
            <div class="modal-header">
                <h3>{{ confirmTitle || 'Confirm' }}</h3>
                <button class="icon-btn" @click="onConfirmNo">×</button>
            </div>
            <div class="modal-body">
                {{ confirmMessage }}
            </div>
            <div class="modal-footer">
                <button class="secondary" @click="onConfirmNo">Cancel</button>
                <button class="primary" @click="onConfirmYes" ref="confirmYesBtn">Confirm</button>
            </div>
        </div>
    </div>
</transition>

<transition name="modal">
    <div v-if="createModalVisible" class="modal-overlay" @keydown="onModalKeydown" tabindex="0">
        <div class="modal-box" :class="{ fullscreen: createModalFullscreen }">
            <div class="modal-header">
                <h3>Create Rule</h3>
                <div style="display:flex; gap:6px; align-items:center;">
                    <button class="icon-btn" @click="toggleCreateModalFullscreen" title="Toggle Fullscreen">⤢</button>
                    <button class="icon-btn" @click="closeCreateRuleModal">×</button>
                </div>
            </div>
            <div class="modal-body">
                <div class="modal-split">
                    <div class="modal-left">
                        <div class="form-group">
                            <label>Source</label>
                            <input :value="createModalPattern" disabled class="full-width">
                        </div>
                        <div class="form-group">
                            <label>Keywords</label>
                            <input v-model="createModalTags" placeholder="comma separated" class="full-width">
                            <div class="chips-list" v-if="createModalTokens.length" style="margin-top:6px;">
                                <span class="chip" v-for="t in createModalTokens" :key="t">
                                    <span @click="toggleKeywordChip(t)">{{ t }}</span>
                                    <button class="icon-btn-tiny" @click="setPatternFromToken(t)">P</button>
                                </span>
                            </div>
                        </div>
                        <div v-if="createModalCategoryId" class="form-group" style="background:var(--bg); padding:8px 10px; border:1px solid var(--accent); border-radius:8px; margin-top:8px;">
                            <div style="font-size:11px; color:var(--muted)">Selected Category</div>
                            <div style="font-weight:600; color:var(--accent); font-size:13px; margin-top:2px;">{{ createModalCategoryName }}</div>
                        </div>
                        <div style="height:1px; background:var(--border); margin:16px 0;"></div>
                        <div class="form-group">
                            <label>Pattern</label>
                            <input v-model="createModalPattern" class="full-width">
                        </div>
                        <div class="row" style="gap:12px;">
                            <div class="form-group" style="flex:1">
                                <label>Type</label>
                                <select v-model="createModalPatternType" class="full-width">
                                    <option value="contains">contains</option>
                                    <option value="equals">equals</option>
                                    <option value="startsWith">startsWith</option>
                                    <option value="endsWith">endsWith</option>
                                    <option value="regex">regex</option>
                                </select>
                            </div>
                            <div class="form-group" style="flex:1">
                                <label>Priority</label>
                                <input v-model.number="createModalPriority" type="number" class="full-width">
                            </div>
                        </div>
                    </div>
                    <div class="modal-right">
                        <div class="form-group" style="height:100%; display:flex; flex-direction:column;">
                            <label>Category Tree</label>
                            <div style="display:flex; align-items:center; gap:6px; margin-bottom:8px;">
                                <input v-model="modalCategoryQuery" placeholder="Search categories..." class="full-width">
                                <button class="icon-btn" @click="modalCategoryQuery=''" title="Clear">×</button>
                            </div>
                            <div class="chips-list" v-if="recentCategories.length" style="margin-bottom:8px;">
                                <span class="chip" v-for="c in recentCategories" :key="c.id" @click="createModalCategoryId=c.id">{{ c.label }}</span>
                            </div>
                            <div class="tree-wrapper">
                                <div class="tree-item"
                                     v-for="c in modalVisibleCategories"
                                     :key="c.id"
                                     :style="{ paddingLeft: ((c.level||0) * 14) + 'px' }"
                                     :class="{ active: createModalCategoryId === (c.code||c.id) }"
                                     @click="modalPickCategory(c)">
                                    <span class="caret" :class="{ hidden: !modalHasChildren(c) }" @click.stop="modalToggleExpand(c)">{{ modalIsExpanded(c) ? '▾' : '▸' }}</span>
                                    <span class="code" v-html="highlightText(c.code, modalCategoryQuery)"></span>
                                    <span class="name" v-html="highlightText(c.name, modalCategoryQuery)"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="secondary" @click="closeCreateRuleModal">Cancel</button>
                <button class="toggle" @click="confirmCreateRuleNext">Save & Next</button>
                <button class="primary" @click="confirmCreateRule">Save Rule</button>
            </div>
        </div>
    </div>
</transition>
{% endverbatim %}
